## 简介：
- 单板机
将CPU芯片、存储器芯片、I/O接口芯片和简单的I/O设备（小键盘、LED显示器）等装配在一块印刷电路板上，再配上监控程序（固化在ROM中），就构成了一台单板微型计算机（简称单板机）
I/O设备简单，软件资源少，使用不方便。
- 单片机：
在一片集成电路芯片上集成微处理器、存储器、I/O接口电路，从而构成了单芯片微型计算机，即单片机。Intel公司推出MCS-51系列单片机：集成8位CPU、4K字节ROM、128字节RAM、4个8位并口、1个全双工串行口、2个16位定时/计数器。寻址范围64k，并有控制功能较强的布尔处理器。

**凡是与控制或简单计算有关的电子设备都可以用单片机来实现**

## 怎么学习：
**实践第一**
补充必要的理论知识，缺什么补什么。
做工程项目积累经验（在网络上搜集题目，自己有什么想法实现）

## 单片机主要掌握
- 最小系统能够运行起来的必要条件
（电源，晶振，复位电路）
- 对单片机任意IO口的随意操作
（输出控制电平高低，输入检测电平高低）
- 定时器：重点掌握最常用的方式2
- 中断：外部中断、定时器中断、串口中断
- 串口通信：单片机之间、单片机与计算机之间


## **预备知识**
- 电平特性
- 2进制与16进制的表示及转换
- 二进制数的逻辑运算
- 8051单片机介绍
- C51基础知识




### 电平特性

数字电路中只有两种电平：高和低
TTL电平（单片机）：
    高  +5V     低  0V
RS-232C电平（计算机）:
    高  -12V    低  +12V
所以计算机与单片机之间通讯时要加电平转换芯片max232（实验板左下角）

### 进制
**B表示为二进制，H表示为十六进制**
1001B -> 9 ->9H
#### 二进制
数字电路中使用二进制


#### 二进制的运算
1.与，&
2.或，+（|）
3.非，ā-非a，！a
4.异或，同或，⊕ ，（圆里面有个点）必须不同，否则没有。
5.按位与，&&
6.按位或，||

##### 16进制
- 是二进制的简短表示形式。
- 熟练掌握二进制与十六进制之间的转换
  （一般是把四个二进制数放在一起转换成一个十六进制数，转换时先把二进制数转换成十进制数，再把十进制数转换成十六进制数。）
  ![image](https://osmanmd.oss-cn-chengdu.aliyuncs.com/image-20220423011146443.png "进制转换")

### 80C51单片机介绍

是MCS-51系列中的一个典型品种；其他厂商以8051为基核开发出的CMOS工艺单片机产品统称为80C51系列。当前常用的80C51系列单片机主要产品有：
intel：80C51、80C31、87C51、80C32、87C52等
ATMEL的：89C51、89C52、89C2051等。
Philips、华邦、Dallas、STC
Siemens(Infineon)等公司的许多产品。



#### 封装。

STC89C52RC40C-PDIP0721CV4336
STC公司
89系列
C表示cmos
52内存为2*4k
40单片机能承受的晶振频率，相当于单片机的运算速度。
C商业级（I工业级）
PDIP封装形式——双列直插
07年21周

其他封装形式：
DIP（Dual ln-line Package)双列直插
PLCC(Plastic Leaded Chip Carrier)带引线的塑料封装
QFP（Quad Flaat Package)塑料方型扁平式封装
PFP（Plastic Flat Package)塑料扁平组件式封装
PGA(Pin Grid Array package)插针网格阵列封装
BGA(Ball Grid package)球栅阵列封装（PBGA,CBGA)


##### 总线型（四组I/O口，每组八位）（40引脚）：
AT89C(编程器写入，S不需要编程器写入,LV)51(-55)

##### 非总线型（20脚）：
STC89E系列

#### 引脚
电源和时钟引脚：Vcc、GND、XTAL1、XTAL2
编程控制引脚：RST、PSEN（低）、ALE/PROG（低）、EA(低）/Vpp
I/O口引脚：P0、P1、P2、P3
#### 常用引脚功能
##### Vcc(40)、GND(20)
单片机电源引脚、不同单片机接入对应电压电源，常压为+5V，低压为3.3V
##### XTAL1(19)、XTAL2(18)
外接时钟引脚
XTAL1为片内振荡电路的输入端
XTAL2为片内振荡电路的输出端
8051的时钟有两种方式，一种是片内时钟振荡方式，需在这两个脚外接石英晶体和振荡电容，振荡电容的值一般去10p-30p；另一种是外部时钟方式，即将XTAL1接地，外部时钟信号从XTAL2输入。
##### RST(9)
单片机的复位引脚。
输入连续两个机器周期以上高电平时为有效，用来完成单片机的复位初始化操作，复位后程序计数器PC=0000H，即复位后将从程序存储器的0000H单元读取第一条指令码，即从头开始执行程序
##### PSEN(29)
程序存储器允许输出控制端
在读外部程序存储器时PSEN低电平有效，以实现外部程序存储器单元的读操作，通俗就是扩展ROM
- 内部ROM读取时，不动作
- 外部ROM读取时，在每个机器周期会运动两次
- 外部RAM读取时，两个PSEN脉冲被跳过不会输出
- 外接ROM时，与ROM的OE脚相接

##### ALE/PROG(30)
单片机扩展外部RAM时，ALE用于控制把P0口的输出低八位地址送锁存器锁存起来，以实现低位地址和数据的隔离。
ALE有可能是高电平也有可能是低电平，
高电平时，允许地址锁存信号，当访问外部存储器时，ALE信号负跳变（即由正变负）
低电平时，P0口上的内容和锁存器输出一致。
在没有访问外部存储器期间，ALE以1/6振荡周期频率输出（即6分频 ）（可以作为外部时钟或外部定时脉冲）
当访问外部存储器时，12分频

PROG为编程脉冲的输入端，单片机的内部有程序存储器（ROM），他的作用是用来存放需要执行的程序。其中的程序是通过编程脉冲输入写进去的 。
（现在很多单片机都不需要编程脉冲引脚写程序了，比如STC，它可以直接通过串口往里面写程序，只需要三条线和计算机相连）

这个引脚用处已经不大了。

##### EA/Vpp（31）
EA接高电平时，单片机读取内部程序存储器。
扩展有外部ROM时，读取完内部的ROM后自动读取外部ROM。
EA接低电平时，单片机直接读取外部
8031内部是没有ROM，8751单片机烧写内部EPROM时，利用此引脚输入21V的烧写电压。
现在用的单片机都有内部ROM所以在设计电路时此引脚始终接高电平

##### I/O口引脚
P0(39-32):
双向8位三态I/O口，每个口可以独立控制。
51单片机P0口内部没有上拉电阻，为高阻状态，所以不能正常地输出高/低电平，一般接入10k欧的电阻
P1(1-8):
准双向8位I/O口，每个口可独立控制，内带上拉电阻。
这种接口输出没有高阻状态，输入也不能拿锁存，所以不是真正的双向I/O口。
该口在作为输入使用前，要先向该口进行写1操作，然后单片机内部才可正确读出外部信号。
52单片机P1.0引脚的第二功能位T2定时器/计数器的外部输入，P1.1引脚的第二功能位T2EX捕捉，重装触发，即T2的外部控制端
P2(21-28):
与P1相似
P3(10-17):
与P1相似，且有第二功能
##### P3第二功能
p3.0:RXD串行口输入
p3.1:TXD串行口输出
p3.2:INTO外部中断0输入
p3.3:INT1外部中断1输入
p3.4:T0定时器0外部输入
p3.5:T1定时器1外部输入
p3.6:WR外部写控制
p3.7：RD外部读控制

#### 总线（BUS)
计算机各部件之间传送信息的公共通道。微机中有内部总线和外部总线两类。内部总线是CPU内部之间的连线。外部总线是指CPU与其他部件之间的连线。外部总线有三种：数据总线（DB)，地址总线（AB)，控制总线（CB)



#### 单片机组成
CPU:
有运算和控制逻辑组成，同时还包括中断系统和部分外部特殊功能寄存器；
RAM：
用以存放可以读写的数据，如运算的中间结果、最终结果以及欲显示的数据；
ROM:
用以存放程序、一些原始数据和表格。
I/O口：
四个8位并行I/O口，既可用作输入，也可用作输出
T/C：
两个定时/记数器，既可以工作在定时模式，也可以工作在记数模式
五个中断源的中断控制系统；
一个全双工UART(通用异步接受发送器）

#### 单片机几个周期

![image-20220427134152445](https://osmanmd.oss-cn-chengdu.aliyuncs.com/image-20220427134152445.png)




### keil的使用
- 工程的建立和软件的开发
- 仿真的基本应用
- 用keil直接硬件仿真TX-1C单片机学习板的方法

#### C51中基本的数据类型
unsigned char   8(所占位数）   0-255
char            8   -128-127
unsigned int    16  0-65535
int             16  -32768-32767
unsigned long   32  0-2^32-1
long            32  -2^31-2^31-1
float           32  3.4e-38-3.4e38
double          64  1.7e-308-1.7e308
bit             1   0-1


一个字节八位

扩充定义：
sfr:特殊功能寄存器声明
sfr16:sfr的16位数据声明
sbit:特殊功能位声明
bit: 位变量声明

包含的头文件：
常用：reg51.h reg52.h math.h

\>\> << 位右移，位左移
& |   按位与 按位或
^  ~  按位异或 按位取反



### 点亮发光二极管

原理图上标号相同相当于物理连接
发光二极管和限流电阻串联，保证安全。

发光二极管电流点亮（大约是3mA)

引脚上面有一横表示该引脚只在低电平工作。

LE锁存，为高电平的时候，输出跟随输入，为低电平的时候输出端保持上次状态。

51单片机默认上电后全是高电平

![image-20220426142056734](https://osmanmd.oss-cn-chengdu.aliyuncs.com/image-20220426142056734.png)

#### 练习
对照TX-1C单片机学习板原理图写程序。
用位操作和总线操作两种方法完成发光二极管的操作。

## 数码管显示原理及应用实现

### 显示原理
依靠点亮内部的发光二极管来发光。

![image-20220426134937763](https://osmanmd.oss-cn-chengdu.aliyuncs.com/image-20220426134937763.png)

一个数码管的引脚是10个，显示一个8字需要七个小段。还有一个小数点。

其中第三和第八引脚是连接在一起的。

公共端分为共阳极和共阴极。

当数码管多位一体时他们呢内部的公共端是对立的，而负责显示什么数字的段线全部是连接在一起的，独立的公共端可以控制多为一体中的哪一位数码管点亮，而连接在一起的段线可以控制这个能点亮数码管亮什么数字，通常把公共端叫做“位选线”，连接在一起的段线叫做“段选线”。

单位数码管10个引脚，二位数码管10个，四位12个（具体查阅资料，或者用数字万用表测量。）

> 用万用表检测数码管的引脚排列

数字万用表，红色表笔连接表内部电源正极，黑色连负极。

利用万用表的内部电源正负极测量公共端

![image-20220426140134373](https://osmanmd.oss-cn-chengdu.aliyuncs.com/image-20220426140134373.png)

### 数码管静态显示

当多位数码管应用于同一系统时，它们的位选是可独立控制的，而”段选“是连接在一起的，可以通过位选信号控制哪几个数码管亮。位选选通的所有数码管上显示的数字始终都是一样的。

因为它们的段选是在一起的。所以送入所有数码管的段选信号都是相同的。这种显示方法叫做静态显示。

![image-20220426140834632](https://osmanmd.oss-cn-chengdu.aliyuncs.com/image-20220426140834632.png)



![image-20220426144431717](https://osmanmd.oss-cn-chengdu.aliyuncs.com/image-20220426144431717.png)



共阴极编码定义

```c
unsigned char code table[]={
    0x3f,0x06,0x5b,0x4f,
    0x66,0x6d,0x7d,0x07,
    0x7f,0x6f,0x77,0x7c,
    0x39,0x5e,0x79,0x71
};
```

### 数码管动态显示

消影，每次送完段选数据后，在送入为位选数据之前，需要加上一句P0=0xff。

在刚送完段选数据后，P0仍然保持着上次的段选数据，若不进行处理，再执行接下来的打开位选锁存器命令后，P0口给位选锁存器送入位选数据，虽然过程短暂，但在数码管高速显示状态下，仍然可以看见数码管出现显示混乱的现象。

### 中断概念

中断是为单片机具有对外部或内部随机发生的事件实时处理而设置的，中断功能的存在，很大程度上提高了单片机处理外部或内部事件的能力。

51单片机内部一共有5个中断源，即有五种情况发生时，会使单片机去处理中断程序。

52单片机一共有六个中断源。（符号、名称、产生条件）

INTO——外部中断0，由P3.2端口线引入，低电平或下降沿引起

INT1——外部中断1，由P3.3端口线引入，低电平或下降沿引起

T0——定时器/计数器0中断，由T0计数器计数回零引起

T1——定时器/计数器1中断，由T1计数器计满回零引起

T2——定时器/计数器中断，由T2计数器计满回零引起

TI/RI——串行口中断，串行端口完成一帧字符发送/接收后引起的

![image-20220426153114877](https://osmanmd.oss-cn-chengdu.aliyuncs.com/image-20220426153114877.png)

**单片机在使用中断功能时，通常需要设置两个与中断有关的寄存器：中断允许寄存器IE和中断优先寄存器IP**

> 中断允许寄存器IE

![image-20220426190902288](https://osmanmd.oss-cn-chengdu.aliyuncs.com/image-20220426190902288.png)

> 中断优先级寄存器

![image-20220426191219184](https://osmanmd.oss-cn-chengdu.aliyuncs.com/image-20220426191219184.png)



#### 定时器中断

51单片机内部共有两个16位可编程的定时器/计数器，即定时器T0和定时器T1。52单片机多了一个T2定时器/计数器。它们既有定时功能又有计数功能，通过设置与它们相关的特殊功能寄存器可以选择 启用定时功能或计数功能。

定时器系统是单片机内部一个独立的硬件部分，与CPU和晶振通过内部某些控制线连接并相互作用，CPU一旦设置开启定时功能后，定时器便在晶振的作用下自动开始计时。

定时器/计数器的实质是加1计数器（16位），由高8位和低8位两个寄存器组成。TMOD是定时器/计数器的工作方式寄存器，确定工作方式；TCON是控制寄存器，控制T0、T1的启动和停止及设置溢出标志。

![image-20220426191848289](https://osmanmd.oss-cn-chengdu.aliyuncs.com/image-20220426191848289.png)

> 定时器/计数器工作方式寄存器TMOD

![image-20220426192027996](C:\Users\Lenovo\AppData\Roaming\Typora\typora-user-images\image-20220426192027996.png)

![image-20220426192105201](https://osmanmd.oss-cn-chengdu.aliyuncs.com/image-20220426192105201.png)

> 定时器/计数器控制寄存器TCON

![image-20220426192131426](https://osmanmd.oss-cn-chengdu.aliyuncs.com/image-20220426192131426.png)

![image-20220426192153009](https://osmanmd.oss-cn-chengdu.aliyuncs.com/image-20220426192153009.png)

每种定时器有四种工作方式，可通过设置TMOD寄存器中的M1M0位来进行工作方式的选择。

对于T0来说，TL0寄存器作为低八位，TH0寄存器作为高八位，组成了16位加1计数器，其逻辑结构框图

![image-20220426204947538](https://osmanmd.oss-cn-chengdu.aliyuncs.com/image-20220426204947538.png)

> 中断服务的写法

![image-20220426205159707](https://osmanmd.oss-cn-chengdu.aliyuncs.com/image-20220426205159707.png)

##### 定时器初值计算

公式：N=65536-（Fosc/FD/(Freq))

N：	定时器16位计数器

Fosc：	晶振频率，系统频率

FD：	分频（Frequency division),通过分频可增大计数器的定时范围。

Freq:	频率（Freq=1000000(微妙）/TIME(微秒)-设定时间)



STC设置定时器T0为12T，和传统的51单片机一样
  1、6MHz说明单片机每秒振荡6000 000次，每1毫秒振荡6000次。
  2、单片机12个振荡时钟定时器计一次，我们需要定时20ms，单片机每1ms计数总量为：6000/12=500，则说明单片机每1ms进行500次计数，我们需要定时20ms所以定时器总的计数为500*20=10000次。
  3、我们已经得出定时器定时20ms需要的计数值，因为定时器为计数到65536才中断，所以需要赋初值为65536-10000=55536；



## 键盘检测原理及应用实现

### 独立键盘检测

键盘实际上就是一组按键，在单片机外围电路中，通常用到的按键都是机械弹性开关，当开关闭合时，线路导通，开关断开时，线路断开。

![image-20220426210846721](https://osmanmd.oss-cn-chengdu.aliyuncs.com/image-20220426210846721.png)

单片机检测按键的原理是：单片机的I/O口既可作为输出也可作为输入使用，当检测按键时用的是它的输入功能，把按键的一端接地，另一端与单片机的某个I/O口相连，开始时先给该I/O口赋一高电平，然后让单片机不断地检测该I/O口是否变为低电平，一旦检测到低电平说明按键按下。

![image-20220426211240149](https://osmanmd.oss-cn-chengdu.aliyuncs.com/image-20220426211240149.png)

单片机在检测键盘是否按下时都要加上去抖动操作。

![image-20220426211643603](https://osmanmd.oss-cn-chengdu.aliyuncs.com/image-20220426211643603.png)



![image-20220426211718689](https://osmanmd.oss-cn-chengdu.aliyuncs.com/image-20220426211718689.png)

### 矩阵键盘检测

独立键盘与单片机连接时，每一个按键都需要单片机的一个I/O口，若某单片机系统需要较多按键，用独立按键会瞻仰过多I/O口资源。

为了节省I/O口线，引入矩阵键盘。

将16个键盘排程4x4。第一行将每个按键的一段连接在一起构成绗线，第一列将每个按键的另一端连接构成列线。共有4行线4列线。

无论是独立按键还是矩阵按键，单片机检测其是否被按下的依据都是一样的。

![image-20220427144821580](https://osmanmd.oss-cn-chengdu.aliyuncs.com/image-20220427144821580.png)

## A/D和D/A工作原理

### 模拟量与数字量概述

如温度、压力、位移、图像等都是模拟量。

电子线路中模拟量通常包括模拟电压和模拟电流，生活用电220V交流电正弦波就属于模拟电压，随着负载大小的变化，其电流大小也跟着变化，这里的电流信号也属于模拟电流。

![image-20220427160254313](https://osmanmd.oss-cn-chengdu.aliyuncs.com/image-20220427160254313.png)

模拟量有可能是标准的正弦波，有可能是不规则的任何波形，也有可能是规则的方波、三角波等，当我们用数值表示其大小时，通常用十进制数表示

单片机系统内部运算时用的全部是数字量，即0和1，因此对单片机而言，我们无法直接操作模拟量，必须将模拟量转换成数字量。

**数字量**是用一系列0和1组成的二进制代码表示某个信号大小的量。用数字量表示同一个模拟量时，数字位数可以多也可以少，位数越多则表示的精度越高。

*若要用数字量完全表示一个模拟量的话，其数字量位数就为无穷多位。现今无法实现*

单片机在采集模拟信号时，通常都需要在前端加上模拟量/数字量转换器，简称模/数转换器，即常说的A/D（Analog to Digital)芯片。

输出模拟信号时，通常在输出级要加上数字量/模拟量转换器，简称数/模转换器，即D/A

### A/D转换原理及参数指标

在A/D转换器中，因为输入的模拟信号在时间上是连续的，而输出的数字信号代码是离散的，所以A/D转换器在进行转换时，必须在一系列选定的瞬间（时间坐标轴上的一些规定点上）对输入的模拟信号采样，然后再把这些采样值转换为数字量。因此，一般的A/D转换过程是通过采样保持、量化和编码这三个步骤完成的，即首先对输入的模拟电压信号采样，采样结束后进入保持时间就按，在这段时间内将采样的电压量转化为数字量，并按一定的编码形式给出转换结果，然后开始下一次采样。

![image-20220427162548460](https://osmanmd.oss-cn-chengdu.aliyuncs.com/image-20220427162548460.png)

#### 采样定理

![image-20220427163303454](https://osmanmd.oss-cn-chengdu.aliyuncs.com/image-20220427163303454.png)

#### 量化与编码

数字信号不仅再时间上是离散的，而且数值上的变化也不是连续的。

任何一个数字量的大小，都是以某个最小数量单位的整数倍来表示的。因此，在用数字量表示采样电压时，也必须把它化成这个最小数量单位的整倍数，这个转化过程就叫做量化。所规定的最小数量单位叫做量化单位，用△表示。

数字信号最低有效位中的1表示的数量大小，就等于△。

把量化的值用二进制代码表示，称为编码。这个二进制代码就是A/D转换的输出信号。

模拟电压是连续的，那么它就不一定能被△整除，因而不可避免地会引入误差，把这种误差叫做量化误差。

![image-20220427164110643](https://osmanmd.oss-cn-chengdu.aliyuncs.com/image-20220427164110643.png)

> 采样-保持电路

电路组成及工作原理

![image-20220427165523570](https://osmanmd.oss-cn-chengdu.aliyuncs.com/image-20220427165523570.png)

![image-20220427165437665](C:\Users\Lenovo\AppData\Roaming\Typora\typora-user-images\image-20220427165437665.png)

改进电路及其工作原理

![image-20220427170418167](https://osmanmd.oss-cn-chengdu.aliyuncs.com/image-20220427170418167.png)

![image-20220427170621464](https://osmanmd.oss-cn-chengdu.aliyuncs.com/image-20220427170621464.png)

#### 直接A/D转换器

直接A/D转换器能把输入的模拟电压直接转换成输出的数字量而不经过中间变量，常用的电路有并行比较型和反馈比较型两类。

##### 并行比较型A/D转换器

![image-20220427170934028](https://osmanmd.oss-cn-chengdu.aliyuncs.com/image-20220427170934028.png)

![image-20220427170944321](https://osmanmd.oss-cn-chengdu.aliyuncs.com/image-20220427170944321.png)

![image-20220427171255574](https://osmanmd.oss-cn-chengdu.aliyuncs.com/image-20220427171255574.png)

![image-20220427171326139](https://osmanmd.oss-cn-chengdu.aliyuncs.com/image-20220427171326139.png)

##### 反馈比较型

![image-20220427171347930](https://osmanmd.oss-cn-chengdu.aliyuncs.com/image-20220427171347930.png)

![image-20220427171356983](https://osmanmd.oss-cn-chengdu.aliyuncs.com/image-20220427171356983.png)

![image-20220427171406643](https://osmanmd.oss-cn-chengdu.aliyuncs.com/image-20220427171406643.png)



![](https://osmanmd.oss-cn-chengdu.aliyuncs.com/image-20220427171444853.png)

![image-20220427171431184](https://osmanmd.oss-cn-chengdu.aliyuncs.com/image-20220427171431184.png)

![image-20220427171515821](https://osmanmd.oss-cn-chengdu.aliyuncs.com/image-20220427171515821.png)

![image-20220427171525839](https://osmanmd.oss-cn-chengdu.aliyuncs.com/image-20220427171525839.png)

##### 间接A/D转换器

![image-20220427171655813](https://osmanmd.oss-cn-chengdu.aliyuncs.com/image-20220427171655813.png)

![image-20220427171705653](https://osmanmd.oss-cn-chengdu.aliyuncs.com/image-20220427171705653.png)

![image-20220427171713027](https://osmanmd.oss-cn-chengdu.aliyuncs.com/image-20220427171713027.png)

![image-20220427171725393](https://osmanmd.oss-cn-chengdu.aliyuncs.com/image-20220427171725393.png)

##### A/D转换器的参数指标

- 分辨率，说明A/D转换器对输入信号的分辨能力。
- 转换误差，表示A/D转换器实际输出的数字量与理论输出数字量之间的差别
- 转换精度，它是A/D转换器的最大量化误差和模拟部分精度的共同体现。
- 转换时间，指A/D转换器从转换控制信号到来开始，到输出端得到稳定的数字信号所经过的时间。（速度，并行>逐次>间接）

#### 练习

![image-20220427172438365](https://osmanmd.oss-cn-chengdu.aliyuncs.com/image-20220427172438365.png)

### ADC0804工作原理及实现方法

一般逐次比较型A/D转换器用得较多，比如ADC0804。

CMOS工艺，20引脚集成芯片，分辨率为8位，转换时间为100us，输入电压范围为0~5V。

芯片内具有三台输出数据锁存器，可以直接连接在数据总线上。

![image-20220428195902215](https://osmanmd.oss-cn-chengdu.aliyuncs.com/image-20220428195902215.png)

![image-20220428195922825](https://osmanmd.oss-cn-chengdu.aliyuncs.com/image-20220428195922825.png)

![image-20220428200105096](https://osmanmd.oss-cn-chengdu.aliyuncs.com/image-20220428200105096.png)

![image-20220428200132527](https://osmanmd.oss-cn-chengdu.aliyuncs.com/image-20220428200132527.png)

![image-20220428200145956](https://osmanmd.oss-cn-chengdu.aliyuncs.com/image-20220428200145956.png)

![image-20220428200220106](https://osmanmd.oss-cn-chengdu.aliyuncs.com/image-20220428200220106.png)

![image-20220428200229930](https://osmanmd.oss-cn-chengdu.aliyuncs.com/image-20220428200229930.png)

![image-20220428200247225](https://osmanmd.oss-cn-chengdu.aliyuncs.com/image-20220428200247225.png)

![image-20220428200258706](https://osmanmd.oss-cn-chengdu.aliyuncs.com/image-20220428200258706.png)

![image-20220428200309055](https://osmanmd.oss-cn-chengdu.aliyuncs.com/image-20220428200309055.png)



![image-20220428200322106](https://osmanmd.oss-cn-chengdu.aliyuncs.com/image-20220428200322106.png)

#### 练习

![image-20220428200335774](https://osmanmd.oss-cn-chengdu.aliyuncs.com/image-20220428200335774.png)



### D/A转换原理及其参数指标

#### D/A转换器的基本原理

![image-20220429192503939](https://osmanmd.oss-cn-chengdu.aliyuncs.com/image-20220429192503939.png)

![image-20220429192516560](https://osmanmd.oss-cn-chengdu.aliyuncs.com/image-20220429192516560.png)

#### 权电阻网络D/A转换器

一个多位二进制数中的每一位的1代表的数值大小称为这一位的位权

![image-20220429192812221](https://osmanmd.oss-cn-chengdu.aliyuncs.com/image-20220429192812221.png)

求和放大器是一个接成负反馈的运算放大器。

#### 倒T形电阻网络D/A转换器

为了克服权电阻网络D/A转换器中电阻阻值相差太大的问题，又设计了称为倒T形电阻网络的D/A转换器。

![image-20220429193141905](https://osmanmd.oss-cn-chengdu.aliyuncs.com/image-20220429193141905.png)

![image-20220430103536756](https://osmanmd.oss-cn-chengdu.aliyuncs.com/image-20220430103536756.png)

![image-20220430103547576](https://osmanmd.oss-cn-chengdu.aliyuncs.com/image-20220430103547576.png)

![image-20220430103721465](https://osmanmd.oss-cn-chengdu.aliyuncs.com/image-20220430103721465.png)

![image-20220430103857528](https://osmanmd.oss-cn-chengdu.aliyuncs.com/image-20220430103857528.png)

#### 具有双极性输出的D/A转换器

二进制运算中通常把带符号的数值表示为补码的形式，所以希望D/A转换器能够把以补码形式输入的正、负极性数分别转换为正、负极性的模拟电压

![image-20220430104135831](https://osmanmd.oss-cn-chengdu.aliyuncs.com/image-20220430104135831.png)

![image-20220430104201964](https://osmanmd.oss-cn-chengdu.aliyuncs.com/image-20220430104201964.png)

![image-20220430104209117](https://osmanmd.oss-cn-chengdu.aliyuncs.com/image-20220430104209117.png)

#### D/A转换器的参数指标

分辨率——D/A转换器模拟输出电压可能被分离的级数

转换误差——表示D/A转换器实际输出的模拟量与理论输出模拟量之间的差别

建立时间（tset)——指输入数字量变化时，输出电压变化到响应稳定电压值需要时间。

转换速率（SR)——打信号工作状态下模拟电压的变化率

温度系数——指在输入不变的情况下，输出模拟电压随温度变化产生的变化量。一般用满刻度输出条件下温度每升高1°C，输出电压变化的百分数作为温度系数。

### DAC0832工作原理及实现方法

DAC0832是使用非常普遍的8位D/A转换器，其转换时间为1us，工作电压为+5V~+15V，基准电压为正负10V.主要由两个8位寄存器和一个8位D/A转换器组成

使用两个寄存器（输入寄存器和DAC寄存器）的好处是可以进行两级缓冲操作，使该操作有更大的灵活性，其转换原理与T型解码网络一样，由于其片内有输入数据寄存器，可以直接与单片机接口。

DAC0832以电流形式输出，当输出需要转换为电压时，可外接运算放大器。

特性：

![image-20220430105634546](https://osmanmd.oss-cn-chengdu.aliyuncs.com/image-20220430105634546.png)

![image-20220430105723570](https://osmanmd.oss-cn-chengdu.aliyuncs.com/image-20220430105723570.png)

![image-20220430105741060](https://osmanmd.oss-cn-chengdu.aliyuncs.com/image-20220430105741060.png)

![image-20220430105750697](https://osmanmd.oss-cn-chengdu.aliyuncs.com/image-20220430105750697.png)

![image-20220430105803103](https://osmanmd.oss-cn-chengdu.aliyuncs.com/image-20220430105803103.png)

![image-20220430105834037](https://osmanmd.oss-cn-chengdu.aliyuncs.com/image-20220430105834037.png)

![image-20220430105900042](https://osmanmd.oss-cn-chengdu.aliyuncs.com/image-20220430105900042.png)

![image-20220430105917796](https://osmanmd.oss-cn-chengdu.aliyuncs.com/image-20220430105917796.png)

![image-20220430105929348](https://osmanmd.oss-cn-chengdu.aliyuncs.com/image-20220430105929348.png)

![image-20220430105939552](https://osmanmd.oss-cn-chengdu.aliyuncs.com/image-20220430105939552.png)

#### 练习

![image-20220430110002808](https://osmanmd.oss-cn-chengdu.aliyuncs.com/image-20220430110002808.png)



### DAC0832输出电流转换成电压的方法

![image-20220430110057354](https://osmanmd.oss-cn-chengdu.aliyuncs.com/image-20220430110057354.png)

![image-20220430110103849](https://osmanmd.oss-cn-chengdu.aliyuncs.com/image-20220430110103849.png)

![image-20220430110243286](https://osmanmd.oss-cn-chengdu.aliyuncs.com/image-20220430110243286.png)

## 串行口通信原理及操作流程

### 并行与串行的基本通信方式

单片机通信是指单片机与计算机或单片机与单片机之间的信息交换，通常单片机与计算机之间的通信用的较多。

通信又并行和串行两种方式，单片机系统以及现代单片机测试系统中，信息的交换多采用串行通信方式。

#### 并行通信方式

通常是将数据字节的各位用多条数据线同时进行传送，每条数据线都需要一条传输线。

![image-20220501154607468](https://osmanmd.oss-cn-chengdu.aliyuncs.com/image-20220501154607468.png)

并行通信控制简单、相对传输速度快，但由于传输线较多，长距离传送时成本高且收、发放的各位同时接受存在困难

#### 串行通信方式

串行通信是将数据字节分成一位一位的形式在一条传输线上逐个地传送，此时只需要一条数据线，外加一条公共信号地线和若干控制信号线。一次只能传送一位，对于一个字节的数据，至少要分八位才能传送完毕。

![image-20220501155333418](https://osmanmd.oss-cn-chengdu.aliyuncs.com/image-20220501155333418.png)

必要过程是：发送时，要把并行数据变成串行数据发送到线路上去，接收时，要把串行信号再变成并行数据，才能被计算机及其他设备识别。

传输线少，长距离传送时成本低，且可以利用电话网等现成的设备，但数据的传送控制比并行通信复杂

有两种方式：异步串行通信，同步串行通信

#### 异步串行通信方式

异步串行通信是指通信的发送与接收设备使用各自的时钟控制数据的发送和接受的过程。为使双方收、发协调，要求发送和接收设备的时钟尽可能一致。

![image-20220501155756636](https://osmanmd.oss-cn-chengdu.aliyuncs.com/image-20220501155756636.png)

异步通信是以字符（构成的帧）为单位进行传输，字符与字符之间的间隙（时间间隔）是任意的，但每个字符中的各位是以固定的时间传送的，即字符之间不一定有位间隔的整数倍关系，但同一字符内的各位之间的距离均为位间隔的整数倍。

异步通信一帧字符信息由4部分组成：起始位、数据位、奇偶校验位和停止位。有的字符信息也有带空闲位形式，即在字符之间有空闲字符。

![image-20220501160230276](https://osmanmd.oss-cn-chengdu.aliyuncs.com/image-20220501160230276.png)

特点：不要求收发双方时钟的严格一致，实现容易，设备开销较小，但每个字符要附加2~3位，用于起止位、校验位和停止位，各帧之间还有间隔，因此传输效率不高。

单片机与单片机之间单片机与计算机之间通信时，通常采用异步串行通信方式

#### 同步串行通信方式

同步通信要建立发送方时钟对接收方时钟的直接控制，使双方达到完全同步。此时，传输数据的位之间的距离均为位间隔的整数倍，同时传送的字符间不留间隙，即保持位同步关系，也保持字符同步关系。发送方对接收方的同步可以通过外同步和自同步两种方法实现。

![image-20220501160920100](https://osmanmd.oss-cn-chengdu.aliyuncs.com/image-20220501160920100.png)



![image-20220501160937280](https://osmanmd.oss-cn-chengdu.aliyuncs.com/image-20220501160937280.png)

此时，传送的数据和控制信息都必须由规定的字符集（如ASCII码）中的字符所组成的。

![image-20220501161222192](https://osmanmd.oss-cn-chengdu.aliyuncs.com/image-20220501161222192.png)

![image-20220501161236099](https://osmanmd.oss-cn-chengdu.aliyuncs.com/image-20220501161236099.png)

![image-20220501161345129](https://osmanmd.oss-cn-chengdu.aliyuncs.com/image-20220501161345129.png)

#### 串行通信的制式

- 单工，单工是指数据传输仅能沿一个方向，不能实现反向传输。
- 半双工，半双工是指数据传输可以沿两个方向，但需要分时进行。
- 全双工，全双工是指数据可以同步进行双向传输。

![image-20220501161537268](https://osmanmd.oss-cn-chengdu.aliyuncs.com/image-20220501161537268.png)

#### 串行通信的错误校验

奇偶校验

![image-20220501161610499](https://osmanmd.oss-cn-chengdu.aliyuncs.com/image-20220501161610499.png)

代码和校验

![image-20220501161632649](https://osmanmd.oss-cn-chengdu.aliyuncs.com/image-20220501161632649.png)

循环冗余校验

![image-20220501161921007](https://osmanmd.oss-cn-chengdu.aliyuncs.com/image-20220501161921007.png)

### RS-232电平与TTL电平的转换

现在用的较多的是MAX232，MAX202，HIN232等芯片，它们同时继承了RS-232电平和TTL电平之间的互转。

下面为没有MAX232这种现成电平转换芯片时，如何用二极管、三极管、电阻、电容等分立元件搭建一个简单的RS-232电平与TTL电平之间的转换电路。

#### 分立元件实现RS-232电平与TTL电平转换电路

![image-20220501162428850](https://osmanmd.oss-cn-chengdu.aliyuncs.com/image-20220501162428850.png)

集成芯片内部都是由最基本电子元件组成，如电阻、电容、二极管、三极管等元件，为了方便用户使用，制造商把这些具有一定功能的分立元件封装到一个芯片内，这样就制成了各种芯片。

MAX232是把TTL电平从0V和5V转换成3V\~15V或-3V\~-15V

![image-20220501163403694](https://osmanmd.oss-cn-chengdu.aliyuncs.com/image-20220501163403694.png)

![image-20220501163410371](https://osmanmd.oss-cn-chengdu.aliyuncs.com/image-20220501163410371.png)

#### MAX232芯片实现RS-232电平与TTL电平转换

MAX232芯片是MAXIM公司生产的、包含两路接收器和驱动器的IC芯片，它的内部有一个电源电压变换器，可以把输入的+5V电源电压变换成RS-232输出电平所需的+10V电压。

![image-20220501164133459](https://osmanmd.oss-cn-chengdu.aliyuncs.com/image-20220501164133459.png)

![image-20220501164312658](https://osmanmd.oss-cn-chengdu.aliyuncs.com/image-20220501164312658.png)

![image-20220501164319351](https://osmanmd.oss-cn-chengdu.aliyuncs.com/image-20220501164319351.png)

![image-20220501164331002](https://osmanmd.oss-cn-chengdu.aliyuncs.com/image-20220501164331002.png)

![image-20220501164338372](https://osmanmd.oss-cn-chengdu.aliyuncs.com/image-20220501164338372.png)

![image-20220501164355404](https://osmanmd.oss-cn-chengdu.aliyuncs.com/image-20220501164355404.png)

![image-20220501164405818](https://osmanmd.oss-cn-chengdu.aliyuncs.com/image-20220501164405818.png)

### 波特率与定时器初值的关系

#### 波特率

单片机或计算机在串口通信时的速率用波特率表示，定义为每秒传输二进制代码的位数，即1波特=1位/秒，单位是bps(位/秒)。

串行接口或终端直接传送串行信息位流的最大距离与传输速率及传输线的电气特性也有关。

当传输线使用每0.3m（约1英尺）有50pf电容的非平衡屏蔽双绞线时，传输距离随传输速率的增加而减小。当比特率超过1000bps时。

在做串口通信实验选择较高速率传输数据时，尽量缩短数据线的长度，为了能使数据安全传输，即使是在较低传输速率下也不要使用太长的数据线。

#### 波特率的计算

在串行通信中，收、发双方对发送或接受数据的速率要有约定。通过编程可对单片机串行口设定为4种工作方式，其中方式0和方式2的波特率是固定的，而方式1和方式3的波特率是可变的，有定时器T1的溢出率决定

![image-20220501165603550](https://osmanmd.oss-cn-chengdu.aliyuncs.com/image-20220501165603550.png)

![image-20220501165620412](https://osmanmd.oss-cn-chengdu.aliyuncs.com/image-20220501165620412.png)

> 电源管理寄存器PCON

PCON在特殊功能寄存器中，字节地址为87H，不能位寻址，用来管理单片机的电源部分，包括上电复位检测、掉电模式、空闲模式等。单片机复位时PCON全部被清0。

![image-20220501165929072](https://osmanmd.oss-cn-chengdu.aliyuncs.com/image-20220501165929072.png)

![image-20220501165936393](https://osmanmd.oss-cn-chengdu.aliyuncs.com/image-20220501165936393.png)

![image-20220501170002338](https://osmanmd.oss-cn-chengdu.aliyuncs.com/image-20220501170002338.png)

![image-20220501170008435](https://osmanmd.oss-cn-chengdu.aliyuncs.com/image-20220501170008435.png)

![image-20220501170018660](https://osmanmd.oss-cn-chengdu.aliyuncs.com/image-20220501170018660.png)

方式1中，定时器计满溢出时，自动进入中断服务程序，然后需要手动再次给定时器装初值。

方式2中，当定时器计满溢出后，单片机会自动为其装初值，并且无须进入中断服务程序进行任何处理，这样定时器溢出的速率就会绝对稳定。

##### 练习

![image-20220501170635194](https://osmanmd.oss-cn-chengdu.aliyuncs.com/image-20220501170635194.png)

> 为什么51系列单片机常用11.0592MHZ的晶振设计

![image-20220501171005588](https://osmanmd.oss-cn-chengdu.aliyuncs.com/image-20220501171005588.png)

![image-20220501171014153](https://osmanmd.oss-cn-chengdu.aliyuncs.com/image-20220501171014153.png)

### 51单片机串行口结构描述

#### 串行口结构

51单片机的串行口是一个可编程全双工的通信接口，具有UART（通用异步收发器）的全部功能，能同时进行数据的发送和接收，也可作为同步移位寄存器使用。

51单片机的串行口主要由两个独立的串行数据缓冲寄存器SBUF（一个发送缓冲寄存器，一个接收缓冲寄存器）和发送控制器、接受控制器、输入移位寄存器及若干控制门电路组成。串行口基本结构：

![image-20220501171412685](https://osmanmd.oss-cn-chengdu.aliyuncs.com/image-20220501171412685.png)

51单片机可以通过特殊功能寄存器SBUF对串行接收或串行发送寄存器进行访问，两个寄存器共用一个地址99H，但在物理上是两个独立的寄存器，由指令操作决定访问哪一个寄存器。

执行写指令时，访问串行发送寄存器；执行读指令时，访问串行接受寄存器。

接收器具有双缓冲结构，即在从接受寄存器中读出前一个已收到的字节之前，便能接收第二个字节，如果第二个字节已经接受完毕，第一个字节还没有读出，则将丢失其中一个字节，编程时应注意。

对于发送器，因为数据是由CPU控制和发送的，所以不需要考虑

与串行口紧密相关的一个特殊功能寄存器是串行口控制寄存器SCON，它用来设定串行口的工作方式、接收/发送控制以及设置状态标志等。

> 串行口控制器

串行口控制寄存器SCON在特殊功能寄存器中，字节地址为98H，可位寻址，SCON用以设定串行口的工作方式、接收/发送控制以及设置状态标志等。

![image-20220501172358350](https://osmanmd.oss-cn-chengdu.aliyuncs.com/image-20220501172358350.png)

![image-20220501172405706](https://osmanmd.oss-cn-chengdu.aliyuncs.com/image-20220501172405706.png)

![image-20220501172423643](https://osmanmd.oss-cn-chengdu.aliyuncs.com/image-20220501172423643.png)

![image-20220501172740518](https://osmanmd.oss-cn-chengdu.aliyuncs.com/image-20220501172740518.png)

![image-20220501173117578](https://osmanmd.oss-cn-chengdu.aliyuncs.com/image-20220501173117578.png)

![image-20220501173821800](https://osmanmd.oss-cn-chengdu.aliyuncs.com/image-20220501173821800.png)

![image-20220501174034658](https://osmanmd.oss-cn-chengdu.aliyuncs.com/image-20220501174034658.png)

#### 串口方式简介

![image-20220501174301808](https://osmanmd.oss-cn-chengdu.aliyuncs.com/image-20220501174301808.png)

![image-20220501175125326](https://osmanmd.oss-cn-chengdu.aliyuncs.com/image-20220501175125326.png)

### 串行口方式1编程与实现

串行口方式1是最常用的通信方式，其传送一帧数据的格式：

![image-20220501175456855](https://osmanmd.oss-cn-chengdu.aliyuncs.com/image-20220501175456855.png)

串行口方式1传送一帧数据共10位，1位起始位（0），8位数据位，最低位在前，高位在后，1位停止位（1），帧与帧之间可以有空闲，也可以无空闲。方式1数据输出时序图和数据输入时序图分别：

![image-20220501175734873](https://osmanmd.oss-cn-chengdu.aliyuncs.com/image-20220501175734873.png)

![image-20220501175741573](https://osmanmd.oss-cn-chengdu.aliyuncs.com/image-20220501175741573.png)

![image-20220501180139939](https://osmanmd.oss-cn-chengdu.aliyuncs.com/image-20220501180139939.png)

![image-20220501180239023](https://osmanmd.oss-cn-chengdu.aliyuncs.com/image-20220501180239023.png)

![image-20220501180303313](https://osmanmd.oss-cn-chengdu.aliyuncs.com/image-20220501180303313.png)

![image-20220501180310582](https://osmanmd.oss-cn-chengdu.aliyuncs.com/image-20220501180310582.png)

#### 练习

![image-20220501180345071](https://osmanmd.oss-cn-chengdu.aliyuncs.com/image-20220501180345071.png)

### 串行口打印在调试程序中的应用

串行口打印功能通常用在程序调试中。

比如：在用单片机调试一个A/D芯片，单片机的外围只接了A/D芯片和串行口，当我们写好单片机程序下载后让其运行，但是不知道这个芯片工作了没，也不知道数值是什么。这时候可以使用串口打印功能，将单片机采集回来的A/D值经过处理后，发送到上位机上，在上位机上用一个简单的串口工具就可看见数据。

#### 练习

![image-20220501191745380](https://osmanmd.oss-cn-chengdu.aliyuncs.com/image-20220501191745380.png)

## 通用型1602、12232，12864液晶操作方法

### 液晶概述

![image-20220501192938014](https://osmanmd.oss-cn-chengdu.aliyuncs.com/image-20220501192938014.png)

![image-20220501192947120](https://osmanmd.oss-cn-chengdu.aliyuncs.com/image-20220501192947120.png)

![image-20220501192957900](https://osmanmd.oss-cn-chengdu.aliyuncs.com/image-20220501192957900.png)

![image-20220501193003866](https://osmanmd.oss-cn-chengdu.aliyuncs.com/image-20220501193003866.png)

![image-20220501193011390](https://osmanmd.oss-cn-chengdu.aliyuncs.com/image-20220501193011390.png)

### 常用1602液晶操作实例

设计两个程序，一个是在液晶的任意位置显示字符，另一个是滚动显示一串字符。

（TX-1C附带液晶只有并行接口，无串行接口）

![image-20220501193516355](https://osmanmd.oss-cn-chengdu.aliyuncs.com/image-20220501193516355.png)

![image-20220501193249624](https://osmanmd.oss-cn-chengdu.aliyuncs.com/image-20220501193249624.png)

![image-20220501193258269](https://osmanmd.oss-cn-chengdu.aliyuncs.com/image-20220501193258269.png)

![image-20220501193306049](https://osmanmd.oss-cn-chengdu.aliyuncs.com/image-20220501193306049.png)

![image-20220501193326694](https://osmanmd.oss-cn-chengdu.aliyuncs.com/image-20220501193326694.png)

![image-20220501193346115](https://osmanmd.oss-cn-chengdu.aliyuncs.com/image-20220501193346115.png)

![image-20220501193405753](https://osmanmd.oss-cn-chengdu.aliyuncs.com/image-20220501193405753.png)

![image-20220501193414316](https://osmanmd.oss-cn-chengdu.aliyuncs.com/image-20220501193414316.png)

![image-20220501193436313](https://osmanmd.oss-cn-chengdu.aliyuncs.com/image-20220501193436313.png)

![image-20220501193447102](https://osmanmd.oss-cn-chengdu.aliyuncs.com/image-20220501193447102.png)

![image-20220501193456483](https://osmanmd.oss-cn-chengdu.aliyuncs.com/image-20220501193456483.png)

![image-20220501193503719](https://osmanmd.oss-cn-chengdu.aliyuncs.com/image-20220501193503719.png)

#### 练习

![image-20220501193533357](https://osmanmd.oss-cn-chengdu.aliyuncs.com/image-20220501193533357.png)

![image-20220501202346512](https://osmanmd.oss-cn-chengdu.aliyuncs.com/image-20220501202346512.png)

### 常用12232液晶操作实例

设计两个程序，一个是在液晶的任意位置显示数字、符号和汉字，另一个是滚动显示一串字符。

#### 接口信号说明

![image-20220503120224333](https://osmanmd.oss-cn-chengdu.aliyuncs.com/image-20220503120224333.png)

![image-20220503120233093](https://osmanmd.oss-cn-chengdu.aliyuncs.com/image-20220503120233093.png)

#### 主要技术参数

![image-20220503120253166](https://osmanmd.oss-cn-chengdu.aliyuncs.com/image-20220503120253166.png)

#### 并行基本操作时序

![image-20220503120343290](https://osmanmd.oss-cn-chengdu.aliyuncs.com/image-20220503120343290.png)

#### 忙标志（BF）

BF标志提供内部工作情况。BF=1表示模块在进行内部操作，此时模块不接受外部指令和数据。BF=0时，模块为准备状态，随时可接受外部指令和数据。

利用STATUS RD指令，可以将BF读到DB7总线来检验模块的工作状态。

#### 字型产生ROM（CGROM）

字型产生ROM（CGROM）提供8192个触发器，用于模块内部屏幕显示开/关控制。DFF=1为开显示（DISPLAY ON)，此时将DDRAM的内容显示在屏幕上。DFF=0为关显示（DISPLAY OFF)。DFF状态是由指令DISPLAY ON/OFF和RST信号控制的。

#### 显示数据RAM（DDRAM）

![image-20220503121124046](https://osmanmd.oss-cn-chengdu.aliyuncs.com/image-20220503121124046.png)

#### 字型产生RAM（CGRAM)

字型产生RAM提供图像定义（造字）功能，可以提供4组16X16点的自定义图像空间。使用者可以将内部字型没有提供的图像字型自行定义到CGRAM中，便可和CGROM中定义过的字型一样，通过DDRAM显示在屏幕上。

#### 地址计数器AC

地址计数器用来储存DDRAM/CGRAM的地址，它可由设定指令暂存器来改变，之后只要读取或写入DDRAM/CGRAM的值，地址计数器就会自动加1，当RS=0且R/非W=1时，地址记数器的值会被读取到DB6~DB0中。

#### 游标/闪烁控制电路

提供硬件游标及闪烁控制电路，由地址计数器的值来指定DDRAM中的游标或闪烁位置。

#### 状态字说明

![image-20220503121723143](https://osmanmd.oss-cn-chengdu.aliyuncs.com/image-20220503121723143.png)

#### 指令说明

![image-20220503121901306](https://osmanmd.oss-cn-chengdu.aliyuncs.com/image-20220503121901306.png)

![image-20220503121917330](https://osmanmd.oss-cn-chengdu.aliyuncs.com/image-20220503121917330.png)

![image-20220503121929811](https://osmanmd.oss-cn-chengdu.aliyuncs.com/image-20220503121929811.png)

#### 并行写操作时序

![image-20220503122025110](https://osmanmd.oss-cn-chengdu.aliyuncs.com/image-20220503122025110.png)

![image-20220503122034109](https://osmanmd.oss-cn-chengdu.aliyuncs.com/image-20220503122034109.png)

![image-20220503122332481](https://osmanmd.oss-cn-chengdu.aliyuncs.com/image-20220503122332481.png)



#### 练习

![image-20220503122511392](https://osmanmd.oss-cn-chengdu.aliyuncs.com/image-20220503122511392.png)

![image-20220503122521936](https://osmanmd.oss-cn-chengdu.aliyuncs.com/image-20220503122521936.png)

### 常用12864液晶的操作实例

与12232操作方法非常相似

![image-20220503122556881](https://osmanmd.oss-cn-chengdu.aliyuncs.com/image-20220503122556881.png)

![image-20220503122603853](https://osmanmd.oss-cn-chengdu.aliyuncs.com/image-20220503122603853.png)

![image-20220503122612540](https://osmanmd.oss-cn-chengdu.aliyuncs.com/image-20220503122612540.png)

![image-20220503122621331](https://osmanmd.oss-cn-chengdu.aliyuncs.com/image-20220503122621331.png)

![image-20220503122628289](https://osmanmd.oss-cn-chengdu.aliyuncs.com/image-20220503122628289.png)

![image-20220503122638857](https://osmanmd.oss-cn-chengdu.aliyuncs.com/image-20220503122638857.png)

![image-20220503122737116](https://osmanmd.oss-cn-chengdu.aliyuncs.com/image-20220503122737116.png)

![image-20220503122749547](https://osmanmd.oss-cn-chengdu.aliyuncs.com/image-20220503122749547.png)

![image-20220503122812271](https://osmanmd.oss-cn-chengdu.aliyuncs.com/image-20220503122812271.png)

![image-20220503122825702](https://osmanmd.oss-cn-chengdu.aliyuncs.com/image-20220503122825702.png)

![image-20220503122840446](https://osmanmd.oss-cn-chengdu.aliyuncs.com/image-20220503122840446.png)

![image-20220503122849959](https://osmanmd.oss-cn-chengdu.aliyuncs.com/image-20220503122849959.png)

![image-20220503122906756](https://osmanmd.oss-cn-chengdu.aliyuncs.com/image-20220503122906756.png)

![image-20220503122915015](https://osmanmd.oss-cn-chengdu.aliyuncs.com/image-20220503122915015.png)

![image-20220503122927029](https://osmanmd.oss-cn-chengdu.aliyuncs.com/image-20220503122927029.png)

#### 练习

![image-20220503122941101](https://osmanmd.oss-cn-chengdu.aliyuncs.com/image-20220503122941101.png)

## I^2^C总线AT24C02芯片应用

### 概述

由PHILIPS公司推出

同步通信的一种特殊形式

接口线少、控制简单、器件封装形式小、通信速率较高等优点。

可以有多个总线器件同时接到总线上

由数据线SDA和时钟线SCL两条线构成通信线路，即可发送数据，也可接收数据。在CPU与被控IC之间、IC与IC之间都可进行双向传送，最高传送速率为400kbps。

各种被控器件均并联在总线上，但每个器件都有唯一的地址。在信息传输过程中，每一个器件既是被控器（或主控器），又是发送器（接收器）。

CPU发出的控制信号分为地址码和数据码两部分：地址码用来选址，即接通需要控制的电路，数据码是通信的内容，这样各IC控制电路虽然挂在同一条总线上，却彼此独立。

#### 硬件结构图

![image-20220503123755031](https://osmanmd.oss-cn-chengdu.aliyuncs.com/image-20220503123755031.png)

I^2^C总线支持多主和主从两种工作方式，通常为主从工作方式。在主从工作方式中，系统只有一个主器件（单片机），其他器件都是具有I^2^C总线的外围从器件。在主从工作方式中，主器件启动数据的发送（发出启动信号），产生时钟信号，发出停止信号。

#### 通信格式

![image-20220503124942705](https://osmanmd.oss-cn-chengdu.aliyuncs.com/image-20220503124942705.png)

#### 数据位的有效性规定

I^2^C总线进行数据传送时，时钟信号为高电平期间，数据线上的数据必须保持稳定，只有在时钟信号为低电平期间，数据线上的高电平或低电平状态才允许变化。

![image-20220503125341412](https://osmanmd.oss-cn-chengdu.aliyuncs.com/image-20220503125341412.png)

#### 发送启动（始）信号

在利用I^2^C总线进行一次数据传输时，首先由主机发出启动信号，启动总线，在SCL为高电平期间，SDA出现上升沿则为启动信号。此时，具有I^2^C总线接口的从器件会检测到该信号，启动时序：

![image-20220503125729662](https://osmanmd.oss-cn-chengdu.aliyuncs.com/image-20220503125729662.png)

#### 发送寻址信号

主机发送启动信号后，再发出寻址信号。器件地址有7位和10位两种。

七位地址寻址方式

位定义：（高7位地址位，最低位方向位-方向位为0表示主机接下来对从器件进行写操作，为1表明主机接下来对从其按进行读操作）

![image-20220503125954269](https://osmanmd.oss-cn-chengdu.aliyuncs.com/image-20220503125954269.png)

主机发送地址时，总线上的每个从机都将这7位地址码与自己的地址进行比较，如果相同，则认为自己正被主机寻址，根据R/W位将自己确定为发送器或接收器。

从机的地址由固定部分和可编程部分组成。在一个系统中可能希望接入多个相同的从机，从机地址中可编程部分决定了可接入总线该类器件的最大数目。

#### 应答信号

![image-20220503131428259](https://osmanmd.oss-cn-chengdu.aliyuncs.com/image-20220503131428259.png)

#### 数据传输

主机发送寻址信号并得到从器件应答后，便可进行数据传输，每次一个字节，但每次传输都应再得到应答信号后再进行下一次字节传送。

#### 非应答信号

当主机为接收设备时，主机对最后一个字节不应答，以向发送设备表示数据传送结束。

#### 发送停止信号

在全部数据传送完毕后，主机发送停止信号，即在SCL为高电平期间，SDA上产生一上升沿信号，停止时序：

![image-20220503131842377](https://osmanmd.oss-cn-chengdu.aliyuncs.com/image-20220503131842377.png)

### 单片机模拟I^2^C总线通信

目前很多单片机都已经具有硬件I^2^C总线控制单元。这类单片机在工作时，总线状态由硬件监测，无须用户介入，操作非常方便。

但有许多单片机并不具有I^2^C总线接口，如51.不过我们可以在单片机应用系统中通过软件模拟I^2^C总线的工作时序，在使用时，只需正确调用各个函数就能方便的扩展I^2^C总线接口器件。

![image-20220503132226225](https://osmanmd.oss-cn-chengdu.aliyuncs.com/image-20220503132226225.png)

![image-20220503132233119](https://osmanmd.oss-cn-chengdu.aliyuncs.com/image-20220503132233119.png)

单片机在模拟总线通信时，需写出几个关键部分的程序：总线初始化、启动信号、应答信号、停止信号、写一个字节、读一个字节。

#### 总线初始化

```c
void init()
{
    SCL=1;
    delay();
    SDA=1;
    delay();
}
```

将总线都拉高以释放总线

#### 启动信号

```c
void start()
{
    SDA=1;
    delay();
    SCL=1;
    delay();
    SDA=0;
    delay();
}
```

SCL在高电平期间，SDA一个下降沿启动信号。

#### 应答信号

```c
void respons()
{
    uchar i=0;
    SCL=1;
    delay();
    while((SDA==1)&&(i<255))
        i++;
    SCL=0;
    delay();
}
```

SCL在高电平期间，SDA被从设备拉为低电平表示应答。上面代码有一个（SDA==1）和（i<255）相与的关系，表示若在一段时间内没有收到从器件的应答则主器件默认从器件已经收到数据而不在等待应答。（因为如果不加这个延时退出，一旦从器件没有发送应答信号，程序将永远停止在这里）

#### 停止信号

```c
void stop()
{
    SDA=0;
    delay();
    SCL=1;
    delay();
    SDA=1;
    delay();
}
```

SCL在高电平期间，SDA一个上升沿停止信号。

#### 写一个字节

```c
void writebyte(uchar date)
{
    uchar i,temp;
    temp=date;
    for(i=0;i<8;i++)
    {
        temp=temp<<1;
        SCL=0;
        delay();
        SDA=CY;
        delay();
        SCL=1;
        delay();
    }
    SCL=0;
    delay();
    SDA=1;
    delay();
}
```

串行发送一个字节时，需要把这个字节中的八位一位一位地发过去"temp=temp<<1"表示将temp左移一位，最高位将移入PSW寄存器地CY位中，然后将CY赋给SDA进而在SCL地控制下发送过去。

#### 读一个字节

```c
uchar readbyte()
{
    uchar i,k;
    SCL=0;
    delay();
    SDA=1;
    for(i=0;i<8;i++)
    {
        SCL=1;
        delay();
        k=(k<<1)|SDA;
        
    }
}
```

串行接收一个字节时需将8位一位一位地接收，然后再组合成一个字节，上面代码中我们定义了一个临时变量k，将k左移一位后与SDA进行“或”运算，一次把8个独立地位放入一个字节中来完成接收。

### E^2^PROM AT24C02与单片机地通信实例

在一些应用系统设计中，有时需要对工作数据进行掉电保护，如电子式电能表等智能化产品。若采用普通存储器，在掉电时需要备用电池供电，并需要在硬件上增加掉电检测电路，但存在电池不可靠及扩展存储芯片占用单片机过多口线地缺点。

#### AT24C02 引脚配置与引脚功能

封装形式有直插（DIP8)和贴片（SO-8)两种。

![image-20220503150613018](https://osmanmd.oss-cn-chengdu.aliyuncs.com/image-20220503150613018.png)

![image-20220503150642198](https://osmanmd.oss-cn-chengdu.aliyuncs.com/image-20220503150642198.png)

#### 引脚功能

![image-20220503152347940](https://osmanmd.oss-cn-chengdu.aliyuncs.com/image-20220503152347940.png)

#### 存储结构与寻址

AT24C02地存储容量为2kb，内部分成32页，每页8B.

操作时有两种寻址方式：芯片寻址和内子地址寻址

- 芯片寻址。AT24C02芯片地址为1010，其地址控制格式为1010A2A1A0 R/W。其中A2,A1,A0。为可编程地址选择位。A2，A1，A0引脚接高、低电平后得到确定的三位编码，与1010形成7位编码，即为该器件的地址码。R/W为芯片读写控制，该位为0。表示对芯片进行读写操作；该位为1，表示对芯片进行读操作。
- 片内子地址寻址。芯片寻址可对内部256B中的任一个进行读/写操作，其寻址范围为00~FF，共256个寻址单元。

#### 读/写操作时序

串行E^2^PROM一般有两种写入方式：一种是字节写入方式，另一种是页写入方式。

页写入方式允许在一个写周期内（10ms左右）对一个字节到一页的若干字节进行编程写入。AT24C02的页面大小为8B。采用页写方式可提高写入效率，但也容易发生事故。AT24C系列片内地址在接收到每一个数据字节后自动加1，故装载一页以内数据字节时，只需要输入首地址，如果写到此页的最后一个字节，主器件继续发送数据，数据将重新从该页的首地址写入，进而造成原来的数据丢失，这就是页地址空间的“上卷”现象。

解决“上卷”的方法是：在第8个数据后将地址强制加1，或是将下一页的首地址重新赋给寄存器。

##### 字节写入方式

单片机在一次数据帧中之访问E^2^PROM一个单元。该方式下，单片机先发送启动信号，然后送一个字节的控制字，再送一个字节的存储器单元子地址，上述几个字节都得到E^2^PROM响应后，再发送8位数据，最后发送1位停止信号。

![image-20220503163748800](https://osmanmd.oss-cn-chengdu.aliyuncs.com/image-20220503163748800.png)

##### 页写入方式

单片机在一个数据写周期内可以连续访问1页（8个）E^2^PROM存储单元。在该方式中，单片机先发送启动信号，接着送一个字节的控制字，再送1个字节的存储器起始单元地址，上述几个字节都得到E^2^PROM应答后就可以发送最多1页的数据，并顺序存放在以指定起始位置开始的相继单元中，最后以停止信号结束。页写入帧格式：

![image-20220503164208930](https://osmanmd.oss-cn-chengdu.aliyuncs.com/image-20220503164208930.png)

##### 指定地址读操作

读指定地址单元的数据。单片机在启动信号后先发送含有片选地址的写操作控制字，E^2^PROM应答后再发送1个（2KB以内的）字节的指定单元的地址，应答后再发送一个含有片选地址的读操作控制字，此时如果E做出应答，被访问单元的数据就会按SCL信号同步出现再串行数据/地址线SDA上。这种读操作的数据帧格式

![image-20220503164649433](https://osmanmd.oss-cn-chengdu.aliyuncs.com/image-20220503164649433.png)

##### 指定位置连续读

此种方式的读地址控制与前面指定地址读相同。单片机接收到每个字节数据后应做出应答。只要E检测到应答信号，其内部的地址寄存器就自动加1指向下一单元，并顺序将指向的单元的数据送到SDA串行数据线上。当需要结束读操作时，单片机接收到数据后在需要应答的时候发送一个非应答信号，接着再发送一个停止信号即可。这种读操作的数据帧格式：

![image-20220503192808998](C:\Users\Lenovo\AppData\Roaming\Typora\typora-user-images\image-20220503192808998.png)

#### TX-1C实验板上AT24C02连接图

![image-20220503193030295](https://osmanmd.oss-cn-chengdu.aliyuncs.com/image-20220503193030295.png)

AT24C02总线内部是漏极开路形式

##### 练习

![image-20220503193521387](https://osmanmd.oss-cn-chengdu.aliyuncs.com/image-20220503193521387.png)

## 基础运放电路专题

### 概述

运算放大器，Operation Amplifier(OA)。线性集成电路。

可对微弱信号进行放大，可作为反相器、电压比较器、电压追随器、积分器、微分器等，并可对电信号做加/减法运算，所以它被称为运算放大器。

#### 放大倍数

运放通常是把较小的电压或电流信号放大成较大的方便后续处理的电压信号，所谓的放大倍数就是指输出信号与输入信号的比值，单位是”倍“，如输入电压信号为10mv，经过运放放大后其输出电压为100mv，那么这里的放大倍数为10倍。

#### 增益

放大倍数也称为增益，实际上这是一个概念的不同叫法。放大器增益的单位是”分贝“(dB)

#### 最大输出电压U~OPP~

能使输出和输入保持不失真关系的最大输出电压。

#### 输入失调电压U~OS~

再室温及标准电源电压下，为了使静态U~O~=0，而在输入端需要加的补偿电压值称为输入失调电压U~OS~，它反映电路中的对称程度和电位配置情况。

#### 输入失调电流I~OS~

在室温及标准电源电压下，当U~O~=0时，两输入端静态电流之差。

#### 输入偏置电流I~OS~

在室温及标准电源电压下，当U~O~=0时，两输入端电流的平均值，即I~B~=(I~B1~+I~B2~)/2.

#### 开环差模电压增益A~UO~

运放没有接反馈电路时的差模电压放大倍数。A~UO~越高，所构成的运算电路越稳定，运算精度也越高。

#### 单位增益带宽

增益带宽=增益X带宽，单位增益带宽是指闭环增益为1时所输出的放大倍数变成0.707倍时，输入信号的频率。

#### 最大差模输入电压U~idm~

U~idm~是指运放两个输入端治安所能承受的最大电压差值。超过该值，输入级某一侧将出现PN结反向击穿现象

#### 差模输入电阻

开环运放两输入端之间的差模输入信号的动态电阻。

#### 最大共模输入电压U~icm~

U~icm~是共模输入电压范围，是标准电压下，两输入端在相同电位时的最大输入电压。一旦超过U~icm~，其共模抑制比将明显下降。

#### 共模抑制比CMRR

CMRR定义为运放开环差模电压放大倍数与其共模电压放大倍数之比。

#### 共模输入电阻

每个输入端到地的共模动态电阻。

#### 转换速率SR

SR表示运放对大信号阶跃输入有多快的反应能力，是在额定大信号输出电压时，运放输出的最大变化速率。

#### 全功率带宽f~pp~

f~pp~是指在正弦输入且运放接成电压跟随器状态时，在额定输出电流及规定失真条件下的额定输出电压所对应的带宽。

> 放大倍数与增益的转换

定义增益时，电压（电流）增益和功率增益的计算公式是不同的

![image-20220503202233922](https://osmanmd.oss-cn-chengdu.aliyuncs.com/image-20220503202233922.png)

![image-20220503202242467](https://osmanmd.oss-cn-chengdu.aliyuncs.com/image-20220503202242467.png)

使用dB单位有以下好处：

- 数值变小，读写方便
- 运算方便

### 反相放大器

单电源运放反相放大器电路：

![image-20220503202440002](https://osmanmd.oss-cn-chengdu.aliyuncs.com/image-20220503202440002.png)

![image-20220503202454254](https://osmanmd.oss-cn-chengdu.aliyuncs.com/image-20220503202454254.png)

第一个式子中的负号是指相位取反，当输入信号是关于0电位对称的三角波或正弦波时，在运放加入双电源并且能够正常工作的前提下，负号方可起作用。

R2为平衡电阻，用来减少输入偏置电流所带来的失调电压，通常取R~1~和R~f~并联后的值（输出失调电压=输入失调电压X闭环增益）。

运放输入端的失调电压有两个主要来源，输入偏置电流（Input bias current)和输入失调电压（Input offset voltage)。对于一个给定的运放，输入失调电压就已经确定了，但是由输入失调电压所带来的失调电压与所采用的电路结构有关，为了在不使用调整电路的情况下减少偏置电流所带来的失调电压，应该使同、反相输入端对地的直流电阻相等，使偏置电流在输入电阻上的压降所带来的失调电压互相抵消。在低内阻信号源放大器中，运放的输入失调电压将称为失调电压误差的主要来源，而对于高内阻信号源放大器中，运放的输入失调电压将成为失调电压误差的主要来源，而对于高内阻信号源放大器，运放的输入偏置电流在信号源内阻上的压降将成为误差的主要来源。

在搞输入阻抗的情况下，失调电压可以采用R~2~的阻值来调整，利用输入偏置电流在其上的压降来对输入失调电压做出补偿，也就是用这个的压降来抵消输入失调电压。

在交流耦合的时候，失调电压显得并不是很重要，这时的主要问题是：失调电压减小了输出电压峰-峰值的线性动态范围。

双电源运放反相放大器：

![image-20220503204156868](https://osmanmd.oss-cn-chengdu.aliyuncs.com/image-20220503204156868.png)

### 同相放大器

![image-20220503204217757](https://osmanmd.oss-cn-chengdu.aliyuncs.com/image-20220503204217757.png)

![image-20220503204253238](https://osmanmd.oss-cn-chengdu.aliyuncs.com/image-20220503204253238.png)

高输入阻抗同相放大器电路。

闭环放大倍数为（R~1~+R~f~)/R~1~。

和反相放大器相比最大的不同在于，其输出信号和输入信号是同相的。

输入阻抗也是相当高的，为运放差模输入阻抗与环路增益的乘积（环路增益=开环增益/闭环增益）。

在直流耦合情况下，输入阻抗对于运放电路的影响比起输入电流，主要是由于其在信号源内阻上所带来的压降来说，是在次要地位的。

输入端悬浮的状态下，本电路的输出可能饱和。

### 电压跟随器

![image-20220503204745388](https://osmanmd.oss-cn-chengdu.aliyuncs.com/image-20220503204745388.png)

![image-20220503204807132](https://osmanmd.oss-cn-chengdu.aliyuncs.com/image-20220503204807132.png)

### 加法器

![image-20220503204842368](https://osmanmd.oss-cn-chengdu.aliyuncs.com/image-20220503204842368.png)

![image-20220503204852417](https://osmanmd.oss-cn-chengdu.aliyuncs.com/image-20220503204852417.png)

### 差分放大器

![image-20220503204926839](https://osmanmd.oss-cn-chengdu.aliyuncs.com/image-20220503204926839.png)

### 微分器

![image-20220503204952163](https://osmanmd.oss-cn-chengdu.aliyuncs.com/image-20220503204952163.png)

![image-20220503205027063](https://osmanmd.oss-cn-chengdu.aliyuncs.com/image-20220503205027063.png)

### 积分器

![image-20220503205050051](https://osmanmd.oss-cn-chengdu.aliyuncs.com/image-20220503205050051.png)





























